<div data-group="Connection Informations">
    <div class="field">
        <label>Hostname</label>
        <Input @bind-value="sqlServer.hostname" />
    </div>
    <div class="field">
        <label>Port</label>
        <InputNumber @bind-value="sqlServer.port" />
    </div>
    <div class="field">
        <label>Integrated Security</label>
        <Checkbox @bind-value="sqlServer.integratedSecurity" />
    </div>
    <div class="field">
        <label>Username</label>
        <Input @bind-value="sqlServer.username" isEnabled="!sqlServer.integratedSecurity" />
    </div>
    <div class="field">
        <label>Password</label>
        <Input @bind-value="sqlServer.password" type="password" isEnabled="!sqlServer.integratedSecurity" />
    </div>
    <div style="margin: 0 auto; ">
        @if (isConnected)
        {
            <Button onClick="Disconnect" isEnabled="session is not null">Disconnect</Button>
        }
        else
        {
            <Button onClickAsync="ConnectAsync" isEnabled="session is not null">Connect</Button>
        }
    </div>
</div>

@code {

    [Parameter] public PowerShellSession session { get; set; }

    [Parameter] public Config.BC.RemoteMachine.SqlServer sqlServer { get; set; }

    bool isConnected => sqlServer.databaseNames.Count > 0;

    async Task ConnectAsync()
    {
        await App.Instance.IncreaseBusinessAsync();

        await sqlServer.FetchDatabaseNames();

        await App.Instance.DecreaseBusinessAsync();
    }

    void Disconnect()
    {
        sqlServer.databaseNames.Clear();

        Root.Instance.RenderLater();
    }

}
